{% extends 'base.html.twig' %}

{% block title %}Hello IndexController!{% endblock %}

{% block body %}

{# form add blog #}
<div id="formBlog" style="display: none">
    {{ form_start(form) }}
        {{ form_row(form.titre, {
            label: 'Titre du Blog : '
        }) }}
        {{ form_row(form.contenue, {
            label: 'Contenue de la page : '
        }) }}
        {{ form_row(form.mainimage, {
            label: 'Image principal : '
        }) }}
        {{ form_row(form.type, {
            label: 'Type : '
        }) }}
        {{ form_row(form.jeu, {
            label: 'Jeu liée a ce blog : '
        }) }}
        {{ form_row(form.image, {
            label: 'Images : '
        }) }}
        
        <button type="submit" class="btn btn-primary">Créer</button>
        <button id="btnFormBlog2" class="btn btn-primary" onclick="showFormBlog()" type="button">Fermer</button> 
    {{ form_end(form) }}
</div>

<br>

<div class="row">

    <div class="col">
        {% if is_granted('ROLE_ADMIN') or is_granted('ROLE_CONTRIBUTOR') %}
            {# btn show form add blog #}
            <button id="btnFormBlog" class="btn btn-success" onclick="showFormBlog()">Créer un nouvel article !</button>
        {% endif %}
    </div>

    {# listing #}
    <div class="col-8">
        <h3 id="titre_page">Liste des articles de blog :</h3>
        <div class="ligne"></div>

        {# liste blog #}
        {% for blog in listeblog %} 
            {# card #}
            <a href="pageblog{{ blog.id }}" class='lien_liste'>
                <div class="card mb-3 card_article_list" style="max-width: 1000px;">
                    <div class="row g-0">
                        <div class="col-md-3">
                            {% set base64 = blog.image %}
                            {% if base64 %}
                                {# <img src="data:image/png;base64, {{ base64 }}" style="max-width:100%;max-height:100%"> #}
                                <img src="data:image/png;base64, {{ base64 }}" style="width:100%;height:100%;object-fit: contain;">
                            {% endif %}
                        </div>
                        <div class="col-md-9 card_all">
                            <div class="card-body card_all">
                                <div class="row card_colo">
                                    <div class="col">
                                        <p class="card-text">par {{ blog.auteur.name }}</p>
                                    </div>
                                    <div class="col text-end">
                                        <p class="card-text">le {{ blog.datetime|date('d/m/Y H:i') }}</p>
                                    </div>
                                </div>
                                <h4 class="card-title">{{ blog.titre }}</h4>
                                <p class="card-text contenue">{{ blog.contenue|slice(0, 50) }} [...]</p> 
                                {# |replace({"<p>":'', "</p>":''})|raw #}
                            </div>
                        </div>
                    </div>
                </div>
            </a>
            {% if app.user %}
                {% if is_granted('ROLE_ADMIN') or blog.auteur == app.user %}
                    <div class="div_btn_article" >
                        <a class="btn_article" href="updatepage_blog_{{ blog.id }}">Modifier</a>
                        <a class="btn_article" href="deletepage/blog/{{ blog.id }}">Supprimer</a>
                    </div>
                {% endif %}
            {% endif %}
        {% endfor %}
    </div>

    <div class="col">
    </div>

</div>

{% endblock %}

{% block javascripts %}
    <script>
        var visible=false;
        
        function showFormBlog(){
            if (visible==false){
                document.getElementById("formBlog").style.display = "block";
                document.getElementById("background_form").style.display = "block";
                document.getElementById("btnFormBlog").innerHTML = "Fermer";
                visible=true;
            }else{
                document.getElementById("formBlog").style.display = "none";
                document.getElementById("background_form").style.display = "none";
                document.getElementById("btnFormBlog").innerHTML = "Créer un nouvel article !";
                visible=false;
            }
        }
    </script>
{% endblock %}
