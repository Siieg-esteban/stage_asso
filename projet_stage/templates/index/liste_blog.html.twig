{% extends 'base.html.twig' %}

{% block title %}Hello IndexController!{% endblock %}

{% block body %}
{# form add blog #}
<div id="formBlog" style="display: none">
    {{ form_start(form) }}
        {{ form_row(form.titre, {
            label: 'Titre du Blog : '
        }) }}
        {{ form_row(form.contenue, {
            label: 'Contenue de la page : '
        }) }}
        {{ form_row(form.mainimage, {
            label: 'Image principal : '
        }) }}
        {{ form_row(form.type, {
            label: 'Type : '
        }) }}
        {{ form_row(form.jeu, {
            label: 'Jeu liée a ce blog : '
        }) }}
        {{ form_row(form.image, {
            label: 'Images : '
        }) }}
        
        <button type="submit" class="btn btn-primary">Créer</button>
        <button id="btnFormBlog2" class="btn btn-primary" onclick="showFormBlog()" type="button">Fermer</button> 
    {{ form_end(form) }}
</div>

<br>

<div class="row">
    <div class="col bloc_page">
    </div>
    <div class="col-10 bloc_titre_page">
        <h3 id="titre_page">Liste des articles de blog :</h3>
    </div>
</div>

<div class="row">
    <div class="col text-start">
        {% if is_granted('ROLE_ADMIN') or is_granted('ROLE_CONTRIBUTOR') %}
            {# btn show form add blog #}
            <button id="btnFormBlog" class="btn_article" onclick="showFormBlog()">Créer un nouvel article !</button>
        {% endif %}
    </div>

    {# listing #}
    <div class="col-10">
        {# liste blog #}
        <div class="row bloc_conteneur">
            {% for blog in listeblog %} 
                <div class="col-6 card_forme" id="card_forme_{{ blog.id }}">
                {# card #}
                <a href="pageblog{{ blog.id }}" onmouseover="card_head_hover({{ blog.id }})" onmouseleave="card_head_leave({{ blog.id }})" class='lien_liste'>
                    <div class=" mb-3 card_article_list" style="max-width: 1000px;">
                        <div class="card_head" id="card_head_{{ blog.id }}">
                            <p class="card-date">le {{ blog.datetime|date('d/m/Y H:i') }}</p>
                            <h4 class="card-title">{{ blog.titre }}</h4>
                        </div>

                        <div class="row g-0">
                            <div class="col-md-3">
                                {% set base64 = blog.image %}
                                {% if base64 %}
                                    {# <img src="data:image/png;base64, {{ base64 }}" style="max-width:100%;max-height:100%"> #}
                                    <img src="data:image/png;base64, {{ base64 }}" style="width:100%;height:100%;object-fit: contain;">
                                {% endif %}
                            </div>
                            <div class="col-md-9 card_all"><br>
                                <div class="card-body card_all">
                                    <p class="card-text contenue">{{ blog.contenue|slice(0, 150)|striptags }} [...]</p> 
                                    <p class="card-text contenue">par <span class="name_user">{{ blog.auteur.name }}</span></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </a>
                {% if app.user %}
                    {% if is_granted('ROLE_ADMIN') or blog.auteur == app.user %}
                    <div class="d-flex flex-row-reverse">
                        <div class="div_btn_article p-2">
                            <a class="btn_article" href="updatepage_blog_{{ blog.id }}">Modifier</a>
                            <a class="btn_article" href="deletepage/blog/{{ blog.id }}">Supprimer</a>
                        </div>
                    </div>
                    {% endif %}
                {% endif %}
                </div>
            {% endfor %}
        </div>
    </div>
</div>
{% endblock %}

{% block javascripts %}
    <script>
        var visible=false;
        
        function showFormBlog(){
            if (visible==false){
                document.getElementById("formBlog").style.display = "block";
                document.getElementById("background_form").style.display = "block";
                document.getElementById("btnFormBlog").innerHTML = "Fermer";
                visible=true;
            }else{
                document.getElementById("formBlog").style.display = "none";
                document.getElementById("background_form").style.display = "none";
                document.getElementById("btnFormBlog").innerHTML = "Créer un nouvel article !";
                visible=false;
            }
        }
        function card_head_hover(x){
            document.getElementById("card_head_"+x).style.transition = "0.4s";
            document.getElementById("card_forme_"+x).style.transition = "0.4s";
            document.getElementById("card_head_"+x).style.backgroundColor = "#F2C030";
            document.getElementById("card_forme_"+x).style.backgroundColor = "#333333";
        }
        function card_head_leave(x){
            document.getElementById("card_head_"+x).style.transition = "0.4s";
            document.getElementById("card_forme_"+x).style.transition = "0.4s";
            document.getElementById("card_head_"+x).style.backgroundColor = "#F2A530";
            document.getElementById("card_forme_"+x).style.backgroundColor = "#1F1F1F";
        }
    </script>
{% endblock %}
